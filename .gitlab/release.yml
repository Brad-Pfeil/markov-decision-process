.version_helpers: &version_helpers
  - source .gitlab/scripts/version_helpers.sh

.release_item:
  image: ${GLAB_IMAGE}
  before_script:
    # Fail fast
    - set -euo pipefail
    # Include version variable helper functions
    - *version_helpers
    # GLAB Login
    - glab auth login --hostname ${CI_SERVER_HOST} --job-token ${CI_JOB_TOKEN}
  script:
    # Get version
    - VERSION_VALUE=$(get_version)
    - echo "Checking for VERSION_VALUE ${VERSION_VALUE:?EMPTY}"
    # Tag name
    - TAG_NAME="${VERSION_VALUE}"
    # Changelog notes
    - CHANGELOG_NOTES="See details in [CHANGELOG.md](${CI_PROJECT_URL}/-/blob/${CI_DEFAULT_BRANCH}/CHANGELOG.md)."
    # Create release
    - glab release create ${TAG_NAME} -N "${CHANGELOG_NOTES}" -r ${CI_COMMIT_SHA}